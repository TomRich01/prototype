<script src="http://code.jquery.com/jquery-1.11.2.js"></script>
<div id="grid">
	<div id="horizontalRuler" class="ruler">
		<b id="hMarker" class="marker"></b>
	</div>
	<div id="verticalRuler" class="ruler">
		<b id="vMarker" class="marker"></b>
	</div>
	<canvas id="canvas" class="grid" width="480" height="360"></canvas>

	<div class="tool-box" id="statusBar"></div>
</div>
</div>

<style>
body{
	position:relative;
	margin:0;
}

#grid {
	font-family:Tahoma,Arial;
	font-size:12px;
	position:absolute;
	top:0;
	left:0;
	width:100%;
	height:100%;
	padding: 20px 0 20px 20px;
	box-sizing:border-box;
	-moz-box-sizing:border-box;
	-webkit-user-select:none;
	-moz-user-select:none;
	-ms-user-select:none;
	user-select:none;
}

#grid * {
	-moz-box-sizing:border-box;
	-webkit-box-sizing:border-box;
	box-sizing:border-box;
}

#grid canvas{
	width:100%;
	height:100%;
	background-size:100px 100px, 100px 100px, 20px 20px, 20px 20px;
	background-position:-1px -1px, -1px -1px, -1px -1px, -1px -1px;
	background-image:linear-gradient(rgba(0,0,0,.3) 1px, transparent 1px),
	linear-gradient(90deg, rgba(0,0,0,.3) 1px, transparent 1px),
	linear-gradient(rgba(0,0,0,.1) 1px, transparent 1px),
	linear-gradient(90deg, rgba(0,0,0,.1) 1px, transparent 1px);
	cursor:crosshair;
}

#grid .ruler {
	position:absolute;
	background:#434445;
	background-size:100px 100px;
	overflow:hidden;

}

#grid .ruler:after {
content:'';
	display:block;
	position:absolute;
	background-size:10px 10px;
	background-position:-1px -1px;
}

#grid #horizontalRuler {
	height:20px;
	width:100% !important;
	left: 0;
	background-image:linear-gradient(90deg, rgba(255,255,255,.4) 1px, transparent 1px);
	box-sizing: border-box;
	background-clip: content-box;
	padding-left: 20px;
	background-position: 19px;
	top: 0;
}

#grid #horizontalRuler:after {
	top:50%; 
	left: 20px;
	width:100%; height:50%;
	background-image:linear-gradient(90deg, rgba(255,255,255,.2) 1px, transparent 1px);
}

#grid #verticalRuler {
	height:100% !important;
	width:20px;
	top: 0;
	left:0;
	background-image:linear-gradient(rgba(255,255,255,.4) 1px, transparent 1px);
	padding-top: 20px;
	box-sizing: border-box;
	background-clip: content-box;
	background-position: 0 19px;
	background:#434445;
}

#grid #verticalRuler:after {
	top: 20px;
	left:50%;
	width:50%;
	height:100%;
	background-image:linear-gradient(rgba(255,255,255,.2) 1px, transparent 1px);
}

#grid ul { list-style:none; padding:0; margin:0; color:#999; position:relative;}
#grid .ruler li { position:absolute }
#grid #horizontalRuler li { top:-1px }
#grid #horizontalRuler li:first-child { display:none }
#grid #verticalRuler li { right:0; margin-top:-12px }

#grid .ruler .marker {
	position:absolute;
	top: 0px; left:0;
	display:block;
	background:rgba(0,255,255,.8);
}

#grid #hMarker { width:1px; height:100% ; left: 20px;}

#grid #vMarker { width:100%; height:1px ; top: 20px;}

#grid .tool-box label { padding:0 .5em }

#grid #statusBar {
	display:block;
	width: 100%;
	height:20px;
	border-top:none;
	margin: 0;
	line-height:20px;
	position: absolute;
	left: 0;
	bottom:0;
	padding-left:20px;
	color:#ccc;
	background:#434445;
}

</style>
<script>
document.addEventListener("DOMContentLoaded",function(){
	$(function() {

		var _win		= $(window),
		_canvas 	= $('#canvas'),
		_ctx 		= _canvas[0].getContext('2d'),

		_color		= '#000',
		_fill		= '#000',
		_stroke 	= 1,

		_cWidth 	= +_canvas.attr('width'),
		_cHeight	= +_canvas.attr('Height'),
		_cPos 		= {
			x: _canvas.offset().left,
			y: _canvas.offset().top
		},

		_mPos = { x:0, y:0 },
		_mOldPos = { x:0, y:0 },
		_mStartPos = { x:0, y:0 },
		isDrag		= false;

		// setup the rulers with counters and markers
		var hRuler 	= $('#horizontalRuler'),
		vRuler 	= $('#verticalRuler'),
		status 	= $('#statusBar'),
		hMarker	= $('#hMarker'),
		vMarker	= $('#vMarker');

		function setupRulers() {
			var hCount = (_cWidth + 1) / 100,
			vCount = (_cHeight + 1) / 100,
			hList = $('<ul/>'),
			vList = $('<ul/>'),
			i = 0, k;

			// clear out the counter first
			hRuler.find('ul').remove();
			vRuler.find('ul').remove();

			// add the coordinates list
			for ( ; i < hCount; i++) {
				k = i * 100;
				hList.append( $('<li>' + k + '</li>').css('left', k) );
			}
			hRuler.css('width', _cWidth).append(hList);

			for (i = 0; i < vCount; i++) {
				k = i * 100;
				vList.append( $('<li>' + k + '</li>').css('top', k) );
			}
			vRuler.css('height', _cHeight).append(vList);
		}
		setupRulers();

		// the main move event
		_canvas.on('mousemove', function(e) {
			var delta, dx, dy;

			_mPos.x = e.pageX - _cPos.x + 20;
			_mPos.y = e.pageY - _cPos.y + 20;

			// move the markers
			hMarker.css('left', _mPos.x);
			vMarker.css('top', _mPos.y);

			// update status
			status.empty().append(
			'<label title="cursor position">X ' + (_mPos.x + 1 - 20)
				+ ' Y ' + (_mPos.y + 1 - 20) + '</label>'
				);

				if (isDrag) {
					delta = dist(_mPos, _mStartPos).delta;
					status.append(
					'<label>X<sub>1</sub> ' + _mStartPos.x 
						+ ' Y<sub>1</sub> ' + _mStartPos.y + '</label>'
						+ '<label>&Delta; ' + delta + '</label>'
						);
					}

					// record the position for next frame
					_mOldPos = _mPos;
				});

				_canvas.on('mousedown', function(e) {
					if (!isDrag) {
						isDrag = true;
						_mStartPos.x = e.pageX - _cPos.x;
						_mStartPos.y = e.pageY - _cPos.y;
					}
				});

				_canvas.on('mouseup', function(e) {
					if (isDrag) {
						isDrag = false;
					}
				});

				// modify canvas size
				var setSizePanel = $('#set_cSize'),
				toolBox = $('#toolBox');

				$('#set_cWidth').val(_cWidth);
				$('#set_cHeight').val(_cHeight);
				setSizePanel.on('change', 'input', function() {
					var that = $(this), val = that.val();
					if (val <= 100 || val > 1200) {
						val = val <= 100 ? 100 : 1200;
						that.val(val);
					}

					if (that.attr('id') == 'set_cWidth') {
						_cWidth = +val;
						_canvas.attr('width', _cWidth);

						status.css('width', _cWidth);
						setSizePanel.css('width', _cWidth >= 300 ? _cWidth : 300);
						toolBox.css('left', _cWidth >= 300 ? _cWidth + 35 : 335);
					}
					else if (that.attr('id') == 'set_cHeight') {
						_cHeight = +val;
						_canvas.attr('height', _cHeight);
						toolBox.css('height', _cHeight + 70);
					}

					// update rulers
					setupRulers();

					// reset the markers
					hMarker.css('left', 0);
					vMarker.css('top', 0);
				}).css('width', _cWidth);

				// toggle grid
				$('#gridOn').on('click', function(e) {
					if ($(this).prop('checked')) {
						_canvas.addClass('grid');
					}
					else {
						_canvas.removeClass('grid');
					}
				});

			});

			function dist(p1, p2) {
				var dx = p2.x - p1.x,
				dy = p2.y - p1.y;

				return { delta: Math.sqrt( dx*dx + dy*dy ) | 0, x: dx, y: dy };
			}
		},false);
</script>
